<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tool T√°ch ·∫¢nh PDF</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; max-width: 700px; margin: 40px auto; background: #f4f4f9; color: #333; }
        .container { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        h2 { text-align: center; color: #444; }
        
        .upload-area { border: 2px dashed #007bff; padding: 30px; text-align: center; border-radius: 8px; margin-bottom: 20px; background: #f9fbff; cursor: pointer; transition: 0.3s; }
        .upload-area:hover { background: #eef5ff; border-color: #0056b3; }
        
        button { padding: 12px 25px; border: none; border-radius: 6px; cursor: pointer; font-size: 16px; font-weight: bold; transition: 0.2s; width: 100%;}
        .btn-primary { background-color: #007bff; color: white; }
        .btn-primary:hover { background-color: #0056b3; }
        .btn-primary:disabled { background-color: #ccc; cursor: not-allowed; }

        /* Thanh ti·∫øn ƒë·ªô */
        .progress-container { margin: 20px 0; display: none; }
        .progress-bar-bg { width: 100%; background-color: #e0e0e0; border-radius: 10px; overflow: hidden; height: 20px; }
        .progress-bar-fill { height: 100%; background-color: #007bff; width: 0%; transition: width 0.3s ease; text-align: center; line-height: 20px; color: white; font-size: 12px; }

        /* Danh s√°ch file */
        .file-list { list-style: none; padding: 0; margin-top: 20px; }
        .file-item { background: #fff; border-bottom: 1px solid #eee; padding: 10px; display: flex; justify-content: space-between; align-items: center; }
        .status { font-weight: bold; font-size: 0.9em; }
        .status.pending { color: #888; }
        .status.processing { color: #e67e22; }
        .status.done { color: #28a745; }
        .status.error { color: #dc3545; }

        .hidden-input { display: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>üìÇ PDF Image Extractor</h2>
    
    <div class="upload-area" onclick="document.getElementById('pdfInput').click()">
        <p>Click ƒë·ªÉ ch·ªçn file ho·∫∑c k√©o th·∫£ PDF v√†o ƒë√¢y</p>
        <input type="file" id="pdfInput" class="hidden-input" multiple accept=".pdf">
    </div>

    <div id="fileListContainer" class="file-list"></div>

    <div class="progress-container" id="progressContainer">
        <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="progressBar">0%</div>
        </div>
        <p style="text-align: center; margin-top: 5px; font-size: 0.9em;" id="progressText">ƒêang ch·ªù...</p>
    </div>

    <button id="startBtn" class="btn-primary" style="display: none;">B·∫Øt ƒë·∫ßu gi·∫£i n√©n</button>
</div>

<script>
    const pdfInput = document.getElementById('pdfInput');
    const fileListContainer = document.getElementById('fileListContainer');
    const startBtn = document.getElementById('startBtn');
    const progressContainer = document.getElementById('progressContainer');
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');

    let selectedFiles = [];

    pdfInput.addEventListener('change', () => {
        selectedFiles = Array.from(pdfInput.files);
        renderFileList();
        if (selectedFiles.length > 0) startBtn.style.display = 'block';
    });

    function renderFileList() {
        fileListContainer.innerHTML = '';
        selectedFiles.forEach((file, index) => {
            const li = document.createElement('li');
            li.className = 'file-item';
            li.innerHTML = `
                <span>üìÑ ${file.name}</span>
                <span id="status-${index}" class="status pending">Ch·ªù x·ª≠ l√Ω</span>
            `;
            fileListContainer.appendChild(li);
        });
    }

    startBtn.addEventListener('click', async () => {
        startBtn.disabled = true;
        progressContainer.style.display = 'block';
        
        for (let i = 0; i < selectedFiles.length; i++) {
            const file = selectedFiles[i];
            const statusElem = document.getElementById(`status-${i}`);
            
            statusElem.textContent = '‚è≥ ƒêang x·ª≠ l√Ω...';
            statusElem.className = 'status processing';
            progressText.textContent = `ƒêang x·ª≠ l√Ω ${i + 1}/${selectedFiles.length}: ${file.name}`;
            
            const formData = new FormData();
            formData.append('pdfFile', file);

            try {
                const response = await fetch('/api/extract-single', {
                    method: 'POST',
                    body: formData
                });
                const result = await response.json();

                if (result.status === 'success') {
                    statusElem.textContent = `‚úÖ Xong (${result.imageCount} ·∫£nh)`;
                    statusElem.className = 'status done';
                } else {
                    statusElem.textContent = `‚ùå L·ªói: ${result.msg}`;
                    statusElem.className = 'status error';
                }
            } catch (err) {
                statusElem.textContent = '‚ùå L·ªói m·∫°ng';
                statusElem.className = 'status error';
            }

            const percent = Math.round(((i + 1) / selectedFiles.length) * 100);
            progressBar.style.width = `${percent}%`;
            progressBar.textContent = `${percent}%`;
        }

        progressText.textContent = 'Ho√†n t·∫•t qu√° tr√¨nh!';
        startBtn.style.display = 'none'; // ·∫®n n√∫t ƒëi khi xong
    });
</script>

</body>
</html>